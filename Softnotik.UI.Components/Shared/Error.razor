@using Microsoft.AspNetCore.Hosting
@using Microsoft.Extensions.Logging
@using System.Text.Json

@inject ILogger<Error> _logger
@inject IToastService _toastService
@inject IHostingEnvironment _hostingEnvironment

<CascadingValue Value="this" IsFixed="true">
    @ChildContent
</CascadingValue>

@code {
    [Parameter]
    public RenderFragment ChildContent { get; set; }

    public async Task ProcessError(Exception ex)
    {
        _toastService.ShowError(
            _hostingEnvironment.IsDevelopment()
                ? "Oops, something has gone wrong. Please check the logs"
                : "Oops, something has gone wrong. Please contact system admin"
        );

        var message = new LogMessage(LogLevel.Error.ToString(), ex.Message, ex.StackTrace, "Client", DateTime.Now.ToString());
        _logger.Log(LogLevel.Error, 0, message, null, (logMessage, _) => JsonSerializer.Serialize(logMessage));
    }
}